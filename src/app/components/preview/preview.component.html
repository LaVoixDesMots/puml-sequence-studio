<div class="card">
  <div class="header">
    <h3 class="title">{{ title() }}</h3>
    <div class="status" *ngIf="loading()">Rendu en cours…</div>
  </div>

  <ng-container *ngIf="!loading() && !error() && safeSvg(); else fallback">
    <div class="svg-host" [innerHTML]="safeSvg()"></div>
  </ng-container>

  <ng-template #fallback>
    <div class="info">
      <p *ngIf="!loading() && !error() && !safeSvg()" class="muted">
        Sélectionnez un fichier <code>.starttpuml</code> pour prévisualiser.
      </p>

      <div *ngIf="error()" class="error">
        <div><strong>Impossible d’afficher le diagramme</strong></div>
        <pre class="pre">{{ error() }}</pre>
      </div>

      <div *ngIf="diagMissing().length" class="warning">
        <div><strong>Includes manquants</strong></div>
        <ul class="ul">
          <li *ngFor="let m of diagMissing()">{{ m }}</li>
        </ul>
      </div>
    </div>
  </ng-template>

  <details style="margin-top:8px">
    <summary>Voir le PUML généré (debug)</summary>
    <pre class="pre">{{ generatedPuml() }}</pre>
  </details>
</div>
